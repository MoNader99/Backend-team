function cov_22h2di4dmt(){var path="C:\\Users\\Dell\\Desktop\\error\\Services\\createplaylist.js";var hash="9cc71d4f194eec5fd3ae39c588868b1fabc9a9ae";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Dell\\Desktop\\error\\Services\\createplaylist.js",statementMap:{"0":{start:{line:2,column:15},end:{line:2,column:33}},"1":{start:{line:3,column:16},end:{line:3,column:38}},"2":{start:{line:4,column:17},end:{line:4,column:35}},"3":{start:{line:7,column:15},end:{line:7,column:45}},"4":{start:{line:8,column:15},end:{line:8,column:50}},"5":{start:{line:9,column:11},end:{line:9,column:42}},"6":{start:{line:10,column:13},end:{line:10,column:45}},"7":{start:{line:18,column:8},end:{line:18,column:17}},"8":{start:{line:20,column:0},end:{line:20,column:27}},"9":{start:{line:24,column:0},end:{line:84,column:3}},"10":{start:{line:26,column:16},end:{line:26,column:36}},"11":{start:{line:27,column:4},end:{line:83,column:6}},"12":{start:{line:28,column:8},end:{line:30,column:9}},"13":{start:{line:29,column:12},end:{line:29,column:36}},"14":{start:{line:31,column:8},end:{line:33,column:9}},"15":{start:{line:32,column:12},end:{line:32,column:69}},"16":{start:{line:35,column:8},end:{line:48,column:13}},"17":{start:{line:36,column:12},end:{line:47,column:19}},"18":{start:{line:37,column:20},end:{line:46,column:25}},"19":{start:{line:38,column:28},end:{line:41,column:58}},"20":{start:{line:42,column:28},end:{line:42,column:46}},"21":{start:{line:44,column:29},end:{line:46,column:25}},"22":{start:{line:45,column:28},end:{line:45,column:46}},"23":{start:{line:52,column:20},end:{line:52,column:28}},"24":{start:{line:53,column:8},end:{line:78,column:11}},"25":{start:{line:54,column:12},end:{line:77,column:13}},"26":{start:{line:55,column:39},end:{line:64,column:18}},"27":{start:{line:63,column:20},end:{line:63,column:97}},"28":{start:{line:66,column:16},end:{line:72,column:19}},"29":{start:{line:67,column:20},end:{line:67,column:35}},"30":{start:{line:68,column:20},end:{line:68,column:34}},"31":{start:{line:70,column:20},end:{line:70,column:35}},"32":{start:{line:71,column:20},end:{line:71,column:76}},"33":{start:{line:75,column:17},end:{line:77,column:13}},"34":{start:{line:76,column:16},end:{line:76,column:92}},"35":{start:{line:82,column:8},end:{line:82,column:52}},"36":{start:{line:89,column:0},end:{line:93,column:1}},"37":{start:{line:90,column:4},end:{line:92,column:7}},"38":{start:{line:91,column:8},end:{line:91,column:44}},"39":{start:{line:94,column:0},end:{line:94,column:21}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:24,column:22},end:{line:24,column:23}},loc:{start:{line:24,column:33},end:{line:84,column:1}},line:24},"1":{name:"(anonymous_1)",decl:{start:{line:27,column:33},end:{line:27,column:34}},loc:{start:{line:27,column:41},end:{line:81,column:5}},line:27},"2":{name:"(anonymous_2)",decl:{start:{line:36,column:58},end:{line:36,column:59}},loc:{start:{line:36,column:69},end:{line:47,column:17}},line:36},"3":{name:"(anonymous_3)",decl:{start:{line:53,column:92},end:{line:53,column:93}},loc:{start:{line:53,column:107},end:{line:78,column:9}},line:53},"4":{name:"(anonymous_4)",decl:{start:{line:62,column:18},end:{line:62,column:19}},loc:{start:{line:62,column:23},end:{line:64,column:17}},line:62},"5":{name:"(anonymous_5)",decl:{start:{line:66,column:45},end:{line:66,column:46}},loc:{start:{line:66,column:52},end:{line:69,column:17}},line:66},"6":{name:"(anonymous_6)",decl:{start:{line:69,column:25},end:{line:69,column:26}},loc:{start:{line:69,column:30},end:{line:72,column:17}},line:69},"7":{name:"(anonymous_7)",decl:{start:{line:81,column:13},end:{line:81,column:14}},loc:{start:{line:81,column:18},end:{line:83,column:5}},line:81},"8":{name:"(anonymous_8)",decl:{start:{line:90,column:20},end:{line:90,column:21}},loc:{start:{line:90,column:24},end:{line:92,column:5}},line:90}},branchMap:{"0":{loc:{start:{line:28,column:8},end:{line:30,column:9}},type:"if",locations:[{start:{line:28,column:8},end:{line:30,column:9}},{start:{line:28,column:8},end:{line:30,column:9}}],line:28},"1":{loc:{start:{line:31,column:8},end:{line:33,column:9}},type:"if",locations:[{start:{line:31,column:8},end:{line:33,column:9}},{start:{line:31,column:8},end:{line:33,column:9}}],line:31},"2":{loc:{start:{line:35,column:8},end:{line:48,column:13}},type:"if",locations:[{start:{line:35,column:8},end:{line:48,column:13}},{start:{line:35,column:8},end:{line:48,column:13}}],line:35},"3":{loc:{start:{line:37,column:20},end:{line:46,column:25}},type:"if",locations:[{start:{line:37,column:20},end:{line:46,column:25}},{start:{line:37,column:20},end:{line:46,column:25}}],line:37},"4":{loc:{start:{line:44,column:29},end:{line:46,column:25}},type:"if",locations:[{start:{line:44,column:29},end:{line:46,column:25}},{start:{line:44,column:29},end:{line:46,column:25}}],line:44},"5":{loc:{start:{line:54,column:12},end:{line:77,column:13}},type:"if",locations:[{start:{line:54,column:12},end:{line:77,column:13}},{start:{line:54,column:12},end:{line:77,column:13}}],line:54},"6":{loc:{start:{line:75,column:17},end:{line:77,column:13}},type:"if",locations:[{start:{line:75,column:17},end:{line:77,column:13}},{start:{line:75,column:17},end:{line:77,column:13}}],line:75},"7":{loc:{start:{line:89,column:0},end:{line:93,column:1}},type:"if",locations:[{start:{line:89,column:0},end:{line:93,column:1}},{start:{line:89,column:0},end:{line:93,column:1}}],line:89}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"9cc71d4f194eec5fd3ae39c588868b1fabc9a9ae"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_22h2di4dmt=function(){return actualCoverage;};return actualCoverage;}cov_22h2di4dmt();//library imports
const express=(cov_22h2di4dmt().s[0]++,require('express'));var bodyParser=(cov_22h2di4dmt().s[1]++,require('body-parser'));const{ObjectID}=(cov_22h2di4dmt().s[2]++,require("mongodb"));//local imports
var{mongoose}=(cov_22h2di4dmt().s[3]++,require("./../db/mongoose.js"));var{playlist}=(cov_22h2di4dmt().s[4]++,require("./../models/playlists.js"));// playlists model
var{User}=(cov_22h2di4dmt().s[5]++,require("./../models/users.js"));// users model
var{images}=(cov_22h2di4dmt().s[6]++,require("./../models/images.js"));// images model
///////////
var app=(cov_22h2di4dmt().s[7]++,express());//configures the middlewear
cov_22h2di4dmt().s[8]++;app.use(bodyParser.json());//post fn takes the url as first paramter and a call back fn 
//the user id is to be passed in the url to know whom this playlist belongs to
cov_22h2di4dmt().s[9]++;app.post('/playlists',(req,res)=>{cov_22h2di4dmt().f[0]++;//console.log(defaultImage);
var token=(cov_22h2di4dmt().s[10]++,req.header('x-auth'));cov_22h2di4dmt().s[11]++;User.findByToken(token).then(user=>{cov_22h2di4dmt().f[1]++;cov_22h2di4dmt().s[12]++;if(!user){cov_22h2di4dmt().b[0][0]++;cov_22h2di4dmt().s[13]++;return Promise.reject();}else{cov_22h2di4dmt().b[0][1]++;}cov_22h2di4dmt().s[14]++;if(!req.body.playlistName){cov_22h2di4dmt().b[1][0]++;cov_22h2di4dmt().s[15]++;return res.status(400).send("Playlist must have a name");}else{cov_22h2di4dmt().b[1][1]++;}var savedImage;cov_22h2di4dmt().s[16]++;if(req.body.image){cov_22h2di4dmt().b[2][0]++;cov_22h2di4dmt().s[17]++;images.findOne({url:req.body.image.url}).then(isImage=>{cov_22h2di4dmt().f[2]++;cov_22h2di4dmt().s[18]++;if(!isImage){cov_22h2di4dmt().b[3][0]++;cov_22h2di4dmt().s[19]++;savedImage=new images({url:req.body.image.url,height:req.body.image.height,width:req.body.image.width});cov_22h2di4dmt().s[20]++;savedImage.save();}else{cov_22h2di4dmt().b[3][1]++;cov_22h2di4dmt().s[21]++;if(isImage){cov_22h2di4dmt().b[4][0]++;cov_22h2di4dmt().s[22]++;savedImage=isImage;}else{cov_22h2di4dmt().b[4][1]++;}}});}else{cov_22h2di4dmt().b[2][1]++;}//PREVENT THE USER FROM HAVING 2 PLAYLISTS WITH THE SAME NAME
var userId2=(cov_22h2di4dmt().s[23]++,user._id);cov_22h2di4dmt().s[24]++;playlist.find({$and:[{userId:userId2},{playlistName:req.body.playlistName}]}).then(myduplicate=>{cov_22h2di4dmt().f[3]++;cov_22h2di4dmt().s[25]++;if(myduplicate.length==0){cov_22h2di4dmt().b[5][0]++;var playlistInstance=(cov_22h2di4dmt().s[26]++,new playlist({userId:userId2,playlistName:req.body.playlistName,privacy:req.body.privacy,image:savedImage// href:playlistInstance.href         // to be uncommented when href is known
},e=>{cov_22h2di4dmt().f[4]++;cov_22h2di4dmt().s[27]++;return res.status(400).send("Coult not create playlist due to missing info");}));cov_22h2di4dmt().s[28]++;playlistInstance.save().then(doc=>{cov_22h2di4dmt().f[5]++;cov_22h2di4dmt().s[29]++;myduplicate=[];cov_22h2di4dmt().s[30]++;res.send(doc);}).catch(e=>{cov_22h2di4dmt().f[6]++;cov_22h2di4dmt().s[31]++;myduplicate=[];cov_22h2di4dmt().s[32]++;res.status(500).send("Could not Create a new playlist");});}else{cov_22h2di4dmt().b[5][1]++;cov_22h2di4dmt().s[33]++;if(myduplicate.length!=0){cov_22h2di4dmt().b[6][0]++;cov_22h2di4dmt().s[34]++;return res.status(400).send("Cannot create 2 playlists with the same name");}else{cov_22h2di4dmt().b[6][1]++;}};});}).catch(e=>{cov_22h2di4dmt().f[7]++;cov_22h2di4dmt().s[35]++;res.status(401).send('Unauthorized Access');});});cov_22h2di4dmt().s[36]++;if(!module.parent){cov_22h2di4dmt().b[7][0]++;cov_22h2di4dmt().s[37]++;app.listen(3000,()=>{cov_22h2di4dmt().f[8]++;cov_22h2di4dmt().s[38]++;console.log("Started on port 3000");});}else{cov_22h2di4dmt().b[7][1]++;}cov_22h2di4dmt().s[39]++;module.exports={app};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZXBsYXlsaXN0LmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYm9keVBhcnNlciIsIk9iamVjdElEIiwibW9uZ29vc2UiLCJwbGF5bGlzdCIsIlVzZXIiLCJpbWFnZXMiLCJhcHAiLCJ1c2UiLCJqc29uIiwicG9zdCIsInJlcSIsInJlcyIsInRva2VuIiwiaGVhZGVyIiwiZmluZEJ5VG9rZW4iLCJ0aGVuIiwidXNlciIsIlByb21pc2UiLCJyZWplY3QiLCJib2R5IiwicGxheWxpc3ROYW1lIiwic3RhdHVzIiwic2VuZCIsInNhdmVkSW1hZ2UiLCJpbWFnZSIsImZpbmRPbmUiLCJ1cmwiLCJpc0ltYWdlIiwiaGVpZ2h0Iiwid2lkdGgiLCJzYXZlIiwidXNlcklkMiIsIl9pZCIsImZpbmQiLCIkYW5kIiwidXNlcklkIiwibXlkdXBsaWNhdGUiLCJsZW5ndGgiLCJwbGF5bGlzdEluc3RhbmNlIiwicHJpdmFjeSIsImUiLCJkb2MiLCJjYXRjaCIsIm1vZHVsZSIsInBhcmVudCIsImxpc3RlbiIsImNvbnNvbGUiLCJsb2ciLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoieWtNQUFBO0FBQ0EsS0FBTUEsQ0FBQUEsT0FBTywwQkFBRUMsT0FBTyxDQUFDLFNBQUQsQ0FBVCxDQUFiLENBQ0EsR0FBSUMsQ0FBQUEsVUFBVSwwQkFBRUQsT0FBTyxDQUFDLGFBQUQsQ0FBVCxDQUFkLENBQ0EsS0FBTSxDQUFDRSxRQUFELDJCQUFXRixPQUFPLENBQUMsU0FBRCxDQUFsQixDQUFOLENBRUE7QUFDQSxHQUFHLENBQUNHLFFBQUQsMkJBQVlILE9BQU8sQ0FBQyxxQkFBRCxDQUFuQixDQUFILENBQ0EsR0FBRyxDQUFDSSxRQUFELDJCQUFZSixPQUFPLENBQUMsMEJBQUQsQ0FBbkIsQ0FBSCxDQUFvRDtBQUNwRCxHQUFHLENBQUNLLElBQUQsMkJBQVFMLE9BQU8sQ0FBQyxzQkFBRCxDQUFmLENBQUgsQ0FBNEM7QUFDNUMsR0FBRyxDQUFDTSxNQUFELDJCQUFV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LElBQXhCLENBQThCMEIsR0FBRCxFQUFPLGtEQUNoQ0wsV0FBVyxDQUFDLEVBQVosQ0FEZ0MseUJBRWhDekIsR0FBRyxDQUFDVyxJQUFKLENBQVNtQixHQUFULEVBQ0gsQ0FIRCxFQUdHQyxLQUhILENBR1VGLENBQUQsRUFBSyxrREFDVkosV0FBVyxDQUFDLEVBQVosQ0FEVSx5QkFFVnpCLEdBQUcsQ0FBQ1UsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLGlDQUFyQixFQUNILENBTkQsRUFRSCxDQXBCRCxJQXFCSyx3REFBR2MsV0FBVyxDQUFDQyxNQUFaLEVBQW9CLENBQXZCLENBQXlCLHFEQUMxQixNQUFPMUIsQ0FBQUEsR0FBRyxDQUFDVSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIsOENBQXJCLENBQVAsQ0FDSCxDQUZJLGlDQUVKLEVBQ0osQ0F6QkQsRUE0QkgsQ0F0REQsRUFzREdvQixLQXRESCxDQXNEVUYsQ0FBRCxFQUFLLGtEQUNWN0IsR0FBRyxDQUFDVSxNQUFKLENBQVcsR0FBWCxFQUFnQkMsSUFBaEIsQ0FBcUIscUJBQXJCLEVBQ0gsQ0F4REQsRUF5REgsQ0E1REQsRSx5QkFpRUEsR0FBRyxDQUFDcUIsTUFBTSxDQUFDQyxNQUFYLENBQWtCLHFEQUNkdEMsR0FBRyxDQUFDdUMsTUFBSixDQUFXLElBQVgsQ0FBZ0IsSUFBSSxrREFDaEJDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHNCQUFaLEVBQ0gsQ0FGRCxFQUdILENBSkQsaUMseUJBS0FKLE1BQU0sQ0FBQ0ssT0FBUCxDQUFlLENBQUMxQyxHQUFELENBQWYiLCJzb3VyY2VzQ29udGVudCI6WyIvL2xpYnJhcnkgaW1wb3J0c1xyXG5jb25zdCBleHByZXNzPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbnZhciBib2R5UGFyc2VyPSByZXF1aXJlKCdib2R5LXBhcnNlcicpO1xyXG5jb25zdCB7T2JqZWN0SUR9PXJlcXVpcmUoXCJtb25nb2RiXCIpO1xyXG5cclxuLy9sb2NhbCBpbXBvcnRzXHJcbnZhcnttb25nb29zZX09IHJlcXVpcmUoXCIuLy4uL2RiL21vbmdvb3NlLmpzXCIpOyAgXHJcbnZhcntwbGF5bGlzdH09IHJlcXVpcmUoXCIuLy4uL21vZGVscy9wbGF5bGlzdHMuanNcIik7IC8vIHBsYXlsaXN0cyBtb2RlbFxyXG52YXJ7VXNlcn09IHJlcXVpcmUoXCIuLy4uL21vZGVscy91c2Vycy5qc1wiKTsgLy8gdXNlcnMgbW9kZWxcclxudmFye2ltYWdlc309IHJlcXVpcmUoXCIuLy4uL21vZGVscy9pbWFnZXMuanNcIik7IC8vIGltYWdlcyBtb2RlbFxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4vLy8vLy8vLy8vL1xyXG52YXIgYXBwPWV4cHJlc3MoKTtcclxuLy9jb25maWd1cmVzIHRoZSBtaWRkbGV3ZWFyXHJcbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xyXG5cclxuLy9wb3N0IGZuIHRha2VzIHRoZSB1cmwgYXMgZmlyc3QgcGFyYW10ZXIgYW5kIGEgY2FsbCBiYWNrIGZuIFxyXG4vL3RoZSB1c2VyIGlkIGlzIHRvIGJlIHBhc3NlZCBpbiB0aGUgdXJsIHRvIGtub3cgd2hvbSB0aGlzIHBsYXlsaXN0IGJlbG9uZ3MgdG9cclxuYXBwLnBvc3QoJy9wbGF5bGlzdHMnLChyZXEscmVzKT0+e1xyXG4gICAgLy9jb25zb2xlLmxvZyhkZWZhdWx0SW1hZ2UpO1xyXG4gICAgdmFyIHRva2VuID0gcmVxLmhlYWRlcigneC1hdXRoJyk7XHJcbiAgICBVc2VyLmZpbmRCeVRva2VuKHRva2VuKS50aGVuKCh1c2VyKT0+e1xyXG4gICAgICAgIGlmKCF1c2VyKXtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCFyZXEuYm9keS5wbGF5bGlzdE5hbWUpe1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoXCJQbGF5bGlzdCBtdXN0IGhhdmUgYSBuYW1lXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc2F2ZWRJbWFnZTtcclxuICAgICAgICBpZihyZXEuYm9keS5pbWFnZSl7XHJcbiAgICAgICAgICAgIGltYWdlcy5maW5kT25lKHt1cmw6cmVxLmJvZHkuaW1hZ2UudXJsfSkudGhlbigoaXNJbWFnZSk9PntcclxuICAgICAgICAgICAgICAgICAgICBpZighaXNJbWFnZSl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlZEltYWdlPSBuZXcgaW1hZ2VzICh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6cmVxLmJvZHkuaW1hZ2UudXJsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OnJlcS5ib2R5LmltYWdlLmhlaWdodCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOnJlcS5ib2R5LmltYWdlLndpZHRoLH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZWRJbWFnZS5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihpc0ltYWdlKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVkSW1hZ2U9aXNJbWFnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAvL1BSRVZFTlQgVEhFIFVTRVIgRlJPTSBIQVZJTkcgMiBQTEFZTElTVFMgV0lUSCBUSEUgU0FNRSBOQU1FXHJcblxyXG4gICAgICAgIHZhciB1c2VySWQyPXVzZXIuX2lkO1xyXG4gICAgICAgIHBsYXlsaXN0LmZpbmQoeyRhbmQ6W3t1c2VySWQ6dXNlcklkMn0se3BsYXlsaXN0TmFtZTpyZXEuYm9keS5wbGF5bGlzdE5hbWUgfV19KS50aGVuKChteWR1cGxpY2F0ZSk9PntcclxuICAgICAgICAgICAgaWYobXlkdXBsaWNhdGUubGVuZ3RoPT0wKXtcclxuICAgICAgICAgICAgICAgIHZhciBwbGF5bGlzdEluc3RhbmNlID0gbmV3IHBsYXlsaXN0KHtcclxuICAgICAgICAgICAgICAgICAgICB1c2VySWQ6dXNlcklkMiwgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0TmFtZTogcmVxLmJvZHkucGxheWxpc3ROYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHByaXZhY3k6IHJlcS5ib2R5LnByaXZhY3ksXHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2U6c2F2ZWRJbWFnZVxyXG4gICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgLy8gaHJlZjpwbGF5bGlzdEluc3RhbmNlLmhyZWYgICAgICAgICAvLyB0byBiZSB1bmNvbW1lbnRlZCB3aGVuIGhyZWYgaXMga25vd25cclxuICAgICAgICAgICAgICAgIH0sKGUpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKFwiQ291bHQgbm90IGNyZWF0ZSBwbGF5bGlzdCBkdWUgdG8gbWlzc2luZyBpbmZvXCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgcGxheWxpc3RJbnN0YW5jZS5zYXZlKCkudGhlbigoZG9jKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIG15ZHVwbGljYXRlPVtdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zZW5kKGRvYyk7ICBcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIG15ZHVwbGljYXRlPVtdO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKFwiQ291bGQgbm90IENyZWF0ZSBhIG5ldyBwbGF5bGlzdFwiKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZihteWR1cGxpY2F0ZS5sZW5ndGghPTApe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKFwiQ2Fubm90IGNyZWF0ZSAyIHBsYXlsaXN0cyB3aXRoIHRoZSBzYW1lIG5hbWVcIik7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgXHJcbiAgICB9KS5jYXRjaCgoZSk9PntcclxuICAgICAgICByZXMuc3RhdHVzKDQwMSkuc2VuZCgnVW5hdXRob3JpemVkIEFjY2VzcycpO1xyXG4gICAgfSlcclxufSk7XHJcblxyXG4gICAgXHJcblxyXG5cclxuaWYoIW1vZHVsZS5wYXJlbnQpe1xyXG4gICAgYXBwLmxpc3RlbigzMDAwLCgpPT57XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJTdGFydGVkIG9uIHBvcnQgMzAwMFwiKTtcclxuICAgIH0pO1xyXG59XHJcbm1vZHVsZS5leHBvcnRzPXthcHB9O1xyXG5cclxuXHJcbiJdfQ==