function cov_13c4rj5uae(){var path="C:\\Users\\Dell\\Desktop\\new\\Services\\ImageService.js";var hash="24d05e8f512221bfe5b19975dc612206c5023bbe";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\Dell\\Desktop\\new\\Services\\ImageService.js",statementMap:{"0":{start:{line:2,column:15},end:{line:2,column:32}},"1":{start:{line:3,column:15},end:{line:3,column:33}},"2":{start:{line:4,column:12},end:{line:4,column:28}},"3":{start:{line:5,column:19},end:{line:5,column:49}},"4":{start:{line:7,column:16},end:{line:7,column:38}},"5":{start:{line:8,column:13},end:{line:8,column:45}},"6":{start:{line:9,column:11},end:{line:9,column:42}},"7":{start:{line:10,column:13},end:{line:10,column:46}},"8":{start:{line:13,column:11},end:{line:13,column:20}},"9":{start:{line:14,column:14},end:{line:14,column:23}},"10":{start:{line:15,column:13},end:{line:15,column:22}},"11":{start:{line:16,column:9},end:{line:16,column:18}},"12":{start:{line:18,column:22},end:{line:18,column:44}},"13":{start:{line:20,column:19},end:{line:30,column:1}},"14":{start:{line:21,column:4},end:{line:29,column:5}},"15":{start:{line:22,column:8},end:{line:28,column:9}},"16":{start:{line:23,column:12},end:{line:23,column:26}},"17":{start:{line:26,column:12},end:{line:26,column:30}},"18":{start:{line:27,column:12},end:{line:27,column:27}},"19":{start:{line:34,column:15},end:{line:37,column:2}},"20":{start:{line:39,column:0},end:{line:39,column:47}},"21":{start:{line:41,column:0},end:{line:54,column:2}},"22":{start:{line:42,column:4},end:{line:53,column:5}},"23":{start:{line:43,column:8},end:{line:43,column:42}},"24":{start:{line:44,column:8},end:{line:44,column:36}},"25":{start:{line:45,column:8},end:{line:48,column:26}},"26":{start:{line:49,column:8},end:{line:49,column:24}},"27":{start:{line:52,column:8},end:{line:52,column:62}},"28":{start:{line:56,column:0},end:{line:74,column:2}},"29":{start:{line:57,column:4},end:{line:60,column:5}},"30":{start:{line:59,column:8},end:{line:59,column:77}},"31":{start:{line:61,column:4},end:{line:61,column:26}},"32":{start:{line:62,column:4},end:{line:62,column:36}},"33":{start:{line:63,column:4},end:{line:63,column:33}},"34":{start:{line:64,column:4},end:{line:64,column:28}},"35":{start:{line:65,column:4},end:{line:65,column:20}},"36":{start:{line:66,column:4},end:{line:68,column:5}},"37":{start:{line:67,column:8},end:{line:67,column:33}},"38":{start:{line:69,column:4},end:{line:71,column:5}},"39":{start:{line:70,column:8},end:{line:70,column:35}},"40":{start:{line:77,column:0},end:{line:83,column:1}},"41":{start:{line:78,column:4},end:{line:80,column:7}},"42":{start:{line:79,column:12},end:{line:79,column:63}},"43":{start:{line:85,column:0},end:{line:91,column:1}},"44":{start:{line:86,column:4},end:{line:88,column:7}},"45":{start:{line:87,column:12},end:{line:87,column:63}},"46":{start:{line:92,column:0},end:{line:107,column:2}},"47":{start:{line:93,column:16},end:{line:93,column:36}},"48":{start:{line:94,column:4},end:{line:106,column:7}},"49":{start:{line:95,column:8},end:{line:100,column:9}},"50":{start:{line:96,column:12},end:{line:96,column:39}},"51":{start:{line:97,column:12},end:{line:97,column:24}},"52":{start:{line:98,column:12},end:{line:98,column:28}},"53":{start:{line:101,column:8},end:{line:103,column:9}},"54":{start:{line:102,column:12},end:{line:102,column:63}},"55":{start:{line:105,column:8},end:{line:105,column:59}},"56":{start:{line:110,column:0},end:{line:125,column:2}},"57":{start:{line:111,column:16},end:{line:111,column:36}},"58":{start:{line:112,column:4},end:{line:124,column:7}},"59":{start:{line:113,column:8},end:{line:118,column:9}},"60":{start:{line:114,column:12},end:{line:114,column:43}},"61":{start:{line:115,column:12},end:{line:115,column:26}},"62":{start:{line:116,column:12},end:{line:116,column:28}},"63":{start:{line:119,column:8},end:{line:121,column:9}},"64":{start:{line:120,column:12},end:{line:120,column:63}},"65":{start:{line:123,column:8},end:{line:123,column:59}},"66":{start:{line:129,column:12},end:{line:129,column:21}},"67":{start:{line:130,column:0},end:{line:130,column:27}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:20,column:19},end:{line:20,column:20}},loc:{start:{line:20,column:34},end:{line:30,column:1}},line:20},"1":{name:"(anonymous_1)",decl:{start:{line:41,column:43},end:{line:41,column:44}},loc:{start:{line:41,column:74},end:{line:54,column:1}},line:41},"2":{name:"(anonymous_2)",decl:{start:{line:56,column:37},end:{line:56,column:38}},loc:{start:{line:56,column:54},end:{line:74,column:1}},line:56},"3":{name:"(anonymous_3)",decl:{start:{line:77,column:42},end:{line:77,column:43}},loc:{start:{line:77,column:59},end:{line:83,column:1}},line:77},"4":{name:"(anonymous_4)",decl:{start:{line:78,column:70},end:{line:78,column:71}},loc:{start:{line:78,column:75},end:{line:80,column:5}},line:78},"5":{name:"(anonymous_5)",decl:{start:{line:85,column:46},end:{line:85,column:47}},loc:{start:{line:85,column:63},end:{line:91,column:1}},line:85},"6":{name:"(anonymous_6)",decl:{start:{line:86,column:72},end:{line:86,column:73}},loc:{start:{line:86,column:77},end:{line:88,column:5}},line:86},"7":{name:"(anonymous_7)",decl:{start:{line:92,column:43},end:{line:92,column:44}},loc:{start:{line:92,column:73},end:{line:107,column:1}},line:92},"8":{name:"(anonymous_8)",decl:{start:{line:94,column:33},end:{line:94,column:34}},loc:{start:{line:94,column:41},end:{line:104,column:5}},line:94},"9":{name:"(anonymous_9)",decl:{start:{line:104,column:13},end:{line:104,column:14}},loc:{start:{line:104,column:18},end:{line:106,column:5}},line:104},"10":{name:"(anonymous_10)",decl:{start:{line:110,column:47},end:{line:110,column:48}},loc:{start:{line:110,column:77},end:{line:125,column:1}},line:110},"11":{name:"(anonymous_11)",decl:{start:{line:112,column:35},end:{line:112,column:36}},loc:{start:{line:112,column:47},end:{line:122,column:5}},line:112},"12":{name:"(anonymous_12)",decl:{start:{line:122,column:13},end:{line:122,column:14}},loc:{start:{line:122,column:18},end:{line:124,column:5}},line:122}},branchMap:{"0":{loc:{start:{line:21,column:4},end:{line:29,column:5}},type:"if",locations:[{start:{line:21,column:4},end:{line:29,column:5}},{start:{line:21,column:4},end:{line:29,column:5}}],line:21},"1":{loc:{start:{line:22,column:8},end:{line:28,column:9}},type:"if",locations:[{start:{line:22,column:8},end:{line:28,column:9}},{start:{line:22,column:8},end:{line:28,column:9}}],line:22},"2":{loc:{start:{line:42,column:4},end:{line:53,column:5}},type:"if",locations:[{start:{line:42,column:4},end:{line:53,column:5}},{start:{line:42,column:4},end:{line:53,column:5}}],line:42},"3":{loc:{start:{line:57,column:4},end:{line:60,column:5}},type:"if",locations:[{start:{line:57,column:4},end:{line:60,column:5}},{start:{line:57,column:4},end:{line:60,column:5}}],line:57},"4":{loc:{start:{line:66,column:4},end:{line:68,column:5}},type:"if",locations:[{start:{line:66,column:4},end:{line:68,column:5}},{start:{line:66,column:4},end:{line:68,column:5}}],line:66},"5":{loc:{start:{line:69,column:4},end:{line:71,column:5}},type:"if",locations:[{start:{line:69,column:4},end:{line:71,column:5}},{start:{line:69,column:4},end:{line:71,column:5}}],line:69},"6":{loc:{start:{line:95,column:8},end:{line:100,column:9}},type:"if",locations:[{start:{line:95,column:8},end:{line:100,column:9}},{start:{line:95,column:8},end:{line:100,column:9}}],line:95},"7":{loc:{start:{line:101,column:8},end:{line:103,column:9}},type:"if",locations:[{start:{line:101,column:8},end:{line:103,column:9}},{start:{line:101,column:8},end:{line:103,column:9}}],line:101},"8":{loc:{start:{line:113,column:8},end:{line:118,column:9}},type:"if",locations:[{start:{line:113,column:8},end:{line:118,column:9}},{start:{line:113,column:8},end:{line:118,column:9}}],line:113},"9":{loc:{start:{line:119,column:8},end:{line:121,column:9}},type:"if",locations:[{start:{line:119,column:8},end:{line:121,column:9}},{start:{line:119,column:8},end:{line:121,column:9}}],line:119}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"24d05e8f512221bfe5b19975dc612206c5023bbe"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_13c4rj5uae=function(){return actualCoverage;};return actualCoverage;}cov_13c4rj5uae();//global
const multer=(cov_13c4rj5uae().s[0]++,require('multer'));const express=(cov_13c4rj5uae().s[1]++,require("express"));const sharp=(cov_13c4rj5uae().s[2]++,require("sharp"));var{mongoose}=(cov_13c4rj5uae().s[3]++,require("./../db/mongoose.js"));//////local
var bodyParser=(cov_13c4rj5uae().s[4]++,require('body-parser'));var{images}=(cov_13c4rj5uae().s[5]++,require("./../models/images.js"));// images model
var{User}=(cov_13c4rj5uae().s[6]++,require("./../models/users.js"));// users model
var{artist}=(cov_13c4rj5uae().s[7]++,require("./../models/artists.js"));//artists model
////////vars
var userId=(cov_13c4rj5uae().s[8]++,undefined);var imageName=(cov_13c4rj5uae().s[9]++,undefined);var newImage=(cov_13c4rj5uae().s[10]++,undefined);var type=(cov_13c4rj5uae().s[11]++,undefined);//wether an artist or a user to know which fns to call
///////
const multerStorage=(cov_13c4rj5uae().s[12]++,multer.memoryStorage());// for image to be stored as a buffer in memory to be able to resize it before saving it in the file
cov_13c4rj5uae().s[13]++;const multerFilter=(req,file,cb)=>{cov_13c4rj5uae().f[0]++;cov_13c4rj5uae().s[14]++;if(file){cov_13c4rj5uae().b[0][0]++;cov_13c4rj5uae().s[15]++;if(file.mimetype.startsWith('image')){cov_13c4rj5uae().b[1][0]++;cov_13c4rj5uae().s[16]++;cb(null,true);}else{cov_13c4rj5uae().b[1][1]++;cov_13c4rj5uae().s[17]++;req.fileError=400;cov_13c4rj5uae().s[18]++;cb(null,false);}}else{cov_13c4rj5uae().b[0][1]++;}};///CONFIGURES THE DEST OF THE UPLOAD 
const upload=(cov_13c4rj5uae().s[19]++,multer({storage:multerStorage,fileFilter:multerFilter}));//
cov_13c4rj5uae().s[20]++;exports.UploadUserPhoto=upload.single('photo');cov_13c4rj5uae().s[21]++;exports.reSizeUserImage=reSizeUserImage=async(req,res,uploadImagefn)=>{cov_13c4rj5uae().f[1]++;cov_13c4rj5uae().s[22]++;if(req.file){cov_13c4rj5uae().b[2][0]++;cov_13c4rj5uae().s[23]++;imageName=userId+Date.now()+".png";cov_13c4rj5uae().s[24]++;req.file.filename=imageName;cov_13c4rj5uae().s[25]++;sharp(req.file.buffer).resize(600,600)//default is centre allignment
.toFormat("png").png({quality:90});cov_13c4rj5uae().s[26]++;uploadImagefn();}else{cov_13c4rj5uae().b[2][1]++;cov_13c4rj5uae().s[27]++;return res.status(400).send("Please Upload an image");}};//
cov_13c4rj5uae().s[28]++;exports.upLoadPhoto=uploadImagefn=async(req,res)=>{cov_13c4rj5uae().f[2]++;cov_13c4rj5uae().s[29]++;if(req.fileError){cov_13c4rj5uae().b[3][0]++;cov_13c4rj5uae().s[30]++;return res.status(400).send("Not an image , please upload an image");}else{cov_13c4rj5uae().b[3][1]++;}cov_13c4rj5uae().s[31]++;newImage=new images();cov_13c4rj5uae().s[32]++;newImage.data=req.file.buffer;cov_13c4rj5uae().s[33]++;newImage.contentType="png";cov_13c4rj5uae().s[34]++;newImage.path=imageName;cov_13c4rj5uae().s[35]++;newImage.save();cov_13c4rj5uae().s[36]++;if(type=="user"){cov_13c4rj5uae().b[4][0]++;cov_13c4rj5uae().s[37]++;AssignUserImage(req,res);}else{cov_13c4rj5uae().b[4][1]++;}cov_13c4rj5uae().s[38]++;if(type=="artist"){cov_13c4rj5uae().b[5][0]++;cov_13c4rj5uae().s[39]++;AssignArtistImage(req,res);}else{cov_13c4rj5uae().b[5][1]++;}};//
cov_13c4rj5uae().s[40]++;exports.AssignUserImage=AssignUserImage=async(req,res)=>{cov_13c4rj5uae().f[3]++;cov_13c4rj5uae().s[41]++;User.findByIdAndUpdate({_id:userId},{$set:{image:newImage}}).then(n=>{cov_13c4rj5uae().f[4]++;cov_13c4rj5uae().s[42]++;res.status(200).send("Image changed successfully");});};cov_13c4rj5uae().s[43]++;exports.AssignArtistImage=AssignArtistImage=async(req,res)=>{cov_13c4rj5uae().f[5]++;cov_13c4rj5uae().s[44]++;artist.findByIdAndUpdate({_id:userId},{$set:{image:newImage}}).then(n=>{cov_13c4rj5uae().f[6]++;cov_13c4rj5uae().s[45]++;res.status(200).send("Image changed successfully");});};cov_13c4rj5uae().s[46]++;exports.AuthenticateUser=AuthenticateUser=async(req,res,uploadImagefn)=>{cov_13c4rj5uae().f[7]++;var token=(cov_13c4rj5uae().s[47]++,req.header('x-auth'));cov_13c4rj5uae().s[48]++;User.findByToken(token).then(user=>{cov_13c4rj5uae().f[8]++;cov_13c4rj5uae().s[49]++;if(user){cov_13c4rj5uae().b[6][0]++;cov_13c4rj5uae().s[50]++;userId=user._id.toString();cov_13c4rj5uae().s[51]++;type="user";cov_13c4rj5uae().s[52]++;uploadImagefn();}else{cov_13c4rj5uae().b[6][1]++;}cov_13c4rj5uae().s[53]++;if(!user){cov_13c4rj5uae().b[7][0]++;cov_13c4rj5uae().s[54]++;return res.status(401).send('Unauthorized Access');}else{cov_13c4rj5uae().b[7][1]++;}}).catch(e=>{cov_13c4rj5uae().f[9]++;cov_13c4rj5uae().s[55]++;return res.status(401).send('Unauthorized Access');});};cov_13c4rj5uae().s[56]++;exports.AuthenticateArtist=AuthenticateArtist=async(req,res,uploadImagefn)=>{cov_13c4rj5uae().f[10]++;var token=(cov_13c4rj5uae().s[57]++,req.header('x-auth'));cov_13c4rj5uae().s[58]++;artist.findByToken(token).then(myArtist=>{cov_13c4rj5uae().f[11]++;cov_13c4rj5uae().s[59]++;if(myArtist){cov_13c4rj5uae().b[8][0]++;cov_13c4rj5uae().s[60]++;userId=myArtist._id.toString();cov_13c4rj5uae().s[61]++;type="artist";cov_13c4rj5uae().s[62]++;uploadImagefn();}else{cov_13c4rj5uae().b[8][1]++;}cov_13c4rj5uae().s[63]++;if(!myArtist){cov_13c4rj5uae().b[9][0]++;cov_13c4rj5uae().s[64]++;return res.status(401).send('Unauthorized Access');}else{cov_13c4rj5uae().b[9][1]++;}}).catch(e=>{cov_13c4rj5uae().f[12]++;cov_13c4rj5uae().s[65]++;return res.status(401).send('Unauthorized Access');});};////
const app=(cov_13c4rj5uae().s[66]++,express());cov_13c4rj5uae().s[67]++;app.use(bodyParser.json());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkltYWdlU2VydmljZS5qcyJdLCJuYW1lcyI6WyJtdWx0ZXIiLCJyZXF1aXJlIiwiZXhwcmVzcyIsInNoYXJwIiwibW9uZ29vc2UiLCJib2R5UGFyc2VyIiwiaW1hZ2VzIiwiVXNlciIsImFydGlzdCIsInVzZXJJZCIsInVuZGVmaW5lZCIsImltYWdlTmFtZSIsIm5ld0ltYWdlIiwidHlwZSIsIm11bHRlclN0b3JhZ2UiLCJtZW1vcnlTdG9yYWdlIiwibXVsdGVyRmlsdGVyIiwicmVxIiwiZmlsZSIsImNiIiwibWltZXR5cGUiLCJzdGFydHNXaXRoIiwiZmlsZUVycm9yIiwidXBsb2FkIiwic3RvcmFnZSIsImZpbGVGaWx0ZXIiLCJleHBvcnRzIiwiVXBsb2FkVXNlclBob3RvIiwic2luZ2xlIiwicmVTaXplVXNlckltYWdlIiwicmVzIiwidXBsb2FkSW1hZ2VmbiIsIkRhdGUiLCJub3ciLCJmaWxlbmFtZSIsImJ1ZmZlciIsInJlc2l6ZSIsInRvRm9ybWF0IiwicG5nIiwicXVhbGl0eSIsInN0YXR1cyIsInNlbmQiLCJ1cExvYWRQaG90byIsImRhdGEiLCJjb250ZW50VHlwZSIsInBhdGgiLCJzYXZlIiwiQXNzaWduVXNlckltYWdlIiwiQXNzaWduQXJ0aXN0SW1hZ2UiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIl9pZCIsIiRzZXQiLCJpbWFnZSIsInRoZW4iLCJuIiwiQXV0aGVudGljYXRlVXNlciIsInRva2VuIiwiaGVhZGVyIiwiZmluZEJ5VG9rZW4iLCJ1c2VyIiwidG9TdHJpbmciLCJjYXRjaCIsImUiLCJBdXRoZW50aWNhdGVBcnRpc3QiLCJteUFydGlzdCIsImFwcCIsInVzZSIsImpzb24iXSwibWFwcGluZ3MiOiJrMFJBQUE7QUFDQSxLQUFNQSxDQUFBQSxNQUFNLDBCQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNQyxDQUFBQSxPQUFPLDBCQUFFRCxPQUFPLENBQUMsU0FBRCxDQUFULENBQWIsQ0FDQSxLQUFNRSxDQUFBQSxL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LE1BQU0sQ0FBQ2tELFdBQVAsQ0FBbUJGLEtBQW5CLEVBQTBCSCxJQUExQixDQUFnQ1csUUFBRCxFQUFZLG1EQUN2QyxHQUFHQSxRQUFILENBQVkscURBQ1J2RCxNQUFNLENBQUN1RCxRQUFRLENBQUNkLEdBQVQsQ0FBYVUsUUFBYixFQUFQLENBRFEseUJBRVIvQyxJQUFJLENBQUMsUUFBTCxDQUZRLHlCQUdSa0IsYUFBYSxHQUVoQixDQUxELGlDQUR1Qyx5QkFPdkMsR0FBRyxDQUFDaUMsUUFBSixDQUFhLHFEQUNULE1BQU9sQyxDQUFBQSxHQUFHLENBQUNVLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxJQUFoQixDQUFxQixxQkFBckIsQ0FBUCxDQUNILENBRkQsaUNBR0gsQ0FWRCxFQVVHb0IsS0FWSCxDQVVVQyxDQUFELEVBQUssbURBQ1YsTUFBT2hDLENBQUFBLEdBQUcsQ0FBQ1UsTUFBSixDQUFXLEdBQVgsRUFBZ0JDLElBQWhCLENBQXFCLHFCQUFyQixDQUFQLENBQ0gsQ0FaRCxFQWFILENBZkQsQ0FrQkE7QUFDQSxLQUFNd0IsQ0FBQUEsR0FBRywyQkFBRy9ELE9BQU8sRUFBVixDQUFULEMseUJBQ0ErRCxHQUFHLENBQUNDLEdBQUosQ0FBUTdELFVBQVUsQ0FBQzhELElBQVgsRUFBUiIsInNvdXJjZXNDb250ZW50IjpbIi8vZ2xvYmFsXHJcbmNvbnN0IG11bHRlciA9IHJlcXVpcmUoJ211bHRlcicpO1xyXG5jb25zdCBleHByZXNzPSByZXF1aXJlKFwiZXhwcmVzc1wiKTtcclxuY29uc3Qgc2hhcnA9cmVxdWlyZShcInNoYXJwXCIpO1xyXG52YXIgeyBtb25nb29zZSB9ID0gcmVxdWlyZShcIi4vLi4vZGIvbW9uZ29vc2UuanNcIik7IFxyXG4vLy8vLy9sb2NhbFxyXG52YXIgYm9keVBhcnNlcj0gcmVxdWlyZSgnYm9keS1wYXJzZXInKTtcclxudmFye2ltYWdlc309IHJlcXVpcmUoXCIuLy4uL21vZGVscy9pbWFnZXMuanNcIik7IC8vIGltYWdlcyBtb2RlbFxyXG52YXJ7VXNlcn09IHJlcXVpcmUoXCIuLy4uL21vZGVscy91c2Vycy5qc1wiKTsgLy8gdXNlcnMgbW9kZWxcclxudmFye2FydGlzdH09IHJlcXVpcmUoXCIuLy4uL21vZGVscy9hcnRpc3RzLmpzXCIpOyAgLy9hcnRpc3RzIG1vZGVsXHJcblxyXG4vLy8vLy8vL3ZhcnNcclxudmFyIHVzZXJJZD11bmRlZmluZWRcclxudmFyIGltYWdlTmFtZT11bmRlZmluZWQ7XHJcbnZhciBuZXdJbWFnZT11bmRlZmluZWQ7XHJcbnZhciB0eXBlPXVuZGVmaW5lZDsgICAvL3dldGhlciBhbiBhcnRpc3Qgb3IgYSB1c2VyIHRvIGtub3cgd2hpY2ggZm5zIHRvIGNhbGxcclxuLy8vLy8vL1xyXG5jb25zdCBtdWx0ZXJTdG9yYWdlID0gbXVsdGVyLm1lbW9yeVN0b3JhZ2UoKTsgIC8vIGZvciBpbWFnZSB0byBiZSBzdG9yZWQgYXMgYSBidWZmZXIgaW4gbWVtb3J5IHRvIGJlIGFibGUgdG8gcmVzaXplIGl0IGJlZm9yZSBzYXZpbmcgaXQgaW4gdGhlIGZpbGVcclxuXHJcbmNvbnN0IG11bHRlckZpbHRlcj0ocmVxLGZpbGUsY2IpPT57ICAgXHJcbiAgICBpZihmaWxlKXtcclxuICAgICAgICBpZihmaWxlLm1pbWV0eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlJykpe1xyXG4gICAgICAgICAgICBjYihudWxsLHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNle1xyXG4gICAgICAgICAgICByZXEuZmlsZUVycm9yPTQwMDtcclxuICAgICAgICAgICAgY2IobnVsbCxmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuXHJcbi8vL0NPTkZJR1VSRVMgVEhFIERFU1QgT0YgVEhFIFVQTE9BRCBcclxuY29uc3QgdXBsb2FkID0gbXVsdGVyKHtcclxuICAgIHN0b3JhZ2U6bXVsdGVyU3RvcmFnZSxcclxuICAgIGZpbGVGaWx0ZXI6IG11bHRlckZpbHRlclxyXG59KTtcclxuLy9cclxuZXhwb3J0cy5VcGxvYWRVc2VyUGhvdG89dXBsb2FkLnNpbmdsZSgncGhvdG8nKTtcclxuXHJcbmV4cG9ydHMucmVTaXplVXNlckltYWdlPSByZVNpemVVc2VySW1hZ2UgPSBhc3luYyAocmVxLHJlcyx1cGxvYWRJbWFnZWZuKT0+e1xyXG4gICAgaWYocmVxLmZpbGUpe1xyXG4gICAgICAgIGltYWdlTmFtZT11c2VySWQrRGF0ZS5ub3coKStcIi5wbmdcIlxyXG4gICAgICAgIHJlcS5maWxlLmZpbGVuYW1lPWltYWdlTmFtZTtcclxuICAgICAgICBzaGFycChyZXEuZmlsZS5idWZmZXIpXHJcbiAgICAgICAgLnJlc2l6ZSg2MDAsNjAwKSAgICAgICAgICAgICAgIC8vZGVmYXVsdCBpcyBjZW50cmUgYWxsaWdubWVudFxyXG4gICAgICAgIC50b0Zvcm1hdChcInBuZ1wiKVxyXG4gICAgICAgIC5wbmcoe3F1YWxpdHk6OTB9KVxyXG4gICAgICAgIHVwbG9hZEltYWdlZm4oKTsgICAgXHJcbiAgICB9XHJcbiAgICBlbHNle1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZChcIlBsZWFzZSBVcGxvYWQgYW4gaW1hZ2VcIik7XHJcbiAgICB9XHJcbn07XHJcbi8vXHJcbmV4cG9ydHMudXBMb2FkUGhvdG8gPSB1cGxvYWRJbWFnZWZuPSBhc3luYyAocmVxLHJlcyk9PntcclxuICAgIGlmKHJlcS5maWxlRXJyb3IpXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5zZW5kKFwiTm90IGFuIGltYWdlICwgcGxlYXNlIHVwbG9hZCBhbiBpbWFnZVwiKTtcclxuICAgIH1cclxuICAgIG5ld0ltYWdlID0gbmV3IGltYWdlcztcclxuICAgIG5ld0ltYWdlLmRhdGEgPSByZXEuZmlsZS5idWZmZXI7XHJcbiAgICBuZXdJbWFnZS5jb250ZW50VHlwZSA9IFwicG5nXCI7XHJcbiAgICBuZXdJbWFnZS5wYXRoPWltYWdlTmFtZTtcclxuICAgIG5ld0ltYWdlLnNhdmUoKTtcclxuICAgIGlmKHR5cGU9PVwidXNlclwiKXtcclxuICAgICAgICBBc3NpZ25Vc2VySW1hZ2UocmVxLHJlcyk7XHJcbiAgICB9XHJcbiAgICBpZih0eXBlPT1cImFydGlzdFwiKXtcclxuICAgICAgICBBc3NpZ25BcnRpc3RJbWFnZShyZXEscmVzKTtcclxuICAgIH1cclxuXHJcblxyXG59O1xyXG4vL1xyXG5cclxuZXhwb3J0cy5Bc3NpZ25Vc2VySW1hZ2UgPUFzc2lnblVzZXJJbWFnZT0gYXN5bmMocmVxLCByZXMpPT57XHJcbiAgICBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKHtfaWQ6dXNlcklkfSx7JHNldDp7aW1hZ2U6bmV3SW1hZ2V9fSkudGhlbigobik9PntcclxuICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoXCJJbWFnZSBjaGFuZ2VkIHN1Y2Nlc3NmdWxseVwiKTtcclxuICAgIH0pO1xyXG4gICAgXHJcblxyXG59XHJcblxyXG5leHBvcnRzLkFzc2lnbkFydGlzdEltYWdlID1Bc3NpZ25BcnRpc3RJbWFnZT0gYXN5bmMocmVxLCByZXMpPT57XHJcbiAgICBhcnRpc3QuZmluZEJ5SWRBbmRVcGRhdGUoe19pZDp1c2VySWR9LHskc2V0OntpbWFnZTpuZXdJbWFnZX19KS50aGVuKChuKT0+e1xyXG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChcIkltYWdlIGNoYW5nZWQgc3VjY2Vzc2Z1bGx5XCIpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuXHJcbn1cclxuZXhwb3J0cy5BdXRoZW50aWNhdGVVc2VyID1BdXRoZW50aWNhdGVVc2VyPWFzeW5jKHJlcSxyZXMsdXBsb2FkSW1hZ2Vmbik9PntcclxuICAgIHZhciB0b2tlbiA9IHJlcS5oZWFkZXIoJ3gtYXV0aCcpO1xyXG4gICAgVXNlci5maW5kQnlUb2tlbih0b2tlbikudGhlbigodXNlcik9PntcclxuICAgICAgICBpZih1c2VyKXtcclxuICAgICAgICAgICAgdXNlcklkPXVzZXIuX2lkLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIHR5cGU9XCJ1c2VyXCI7XHJcbiAgICAgICAgICAgIHVwbG9hZEltYWdlZm4oKTtcclxuXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCF1c2VyKXtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKCdVbmF1dGhvcml6ZWQgQWNjZXNzJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSkuY2F0Y2goKGUpPT57XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKCdVbmF1dGhvcml6ZWQgQWNjZXNzJyk7XHJcbiAgICB9KTtcclxufTtcclxuXHJcblxyXG5leHBvcnRzLkF1dGhlbnRpY2F0ZUFydGlzdCA9QXV0aGVudGljYXRlQXJ0aXN0PWFzeW5jKHJlcSxyZXMsdXBsb2FkSW1hZ2Vmbik9PntcclxuICAgIHZhciB0b2tlbiA9IHJlcS5oZWFkZXIoJ3gtYXV0aCcpO1xyXG4gICAgYXJ0aXN0LmZpbmRCeVRva2VuKHRva2VuKS50aGVuKChteUFydGlzdCk9PntcclxuICAgICAgICBpZihteUFydGlzdCl7XHJcbiAgICAgICAgICAgIHVzZXJJZD1teUFydGlzdC5faWQudG9TdHJpbmcoKTtcclxuICAgICAgICAgICAgdHlwZT1cImFydGlzdFwiO1xyXG4gICAgICAgICAgICB1cGxvYWRJbWFnZWZuKCk7XHJcblxyXG4gICAgICAgIH1cclxuICAgICAgICBpZighbXlBcnRpc3Qpe1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoJ1VuYXV0aG9yaXplZCBBY2Nlc3MnKTtcclxuICAgICAgICB9XHJcbiAgICB9KS5jYXRjaCgoZSk9PntcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoJ1VuYXV0aG9yaXplZCBBY2Nlc3MnKTtcclxuICAgIH0pO1xyXG59O1xyXG5cclxuXHJcbi8vLy9cclxuY29uc3QgYXBwID0gZXhwcmVzcygpO1xyXG5hcHAudXNlKGJvZHlQYXJzZXIuanNvbigpKTtcclxuXHJcbiJdfQ==